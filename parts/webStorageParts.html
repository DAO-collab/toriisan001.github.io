<div id="webStorage">
<h1>WebStorage</h1>

<h2>localStorage</h2>
<div id="textbox"></div>
<div style="padding-top: 5px; display: flex;">
    <p>キー：<input id="k" type="text"></p>
    <p>値：<input id="v" type="text"></p>
</div>
<div style="padding-top: 5px;">
    <input type="button" value="新規・更新" onClick="set()">
    <input type="button" value="全クリア" onClick="if (confirm('テキストを全て削除してよいですか？')) cle(); return false;">
</div>
<p><a href="http://www.htmq.com/webstorage/">Web Storage－HTML5のAPI - HTMLクイックリファレンス（参考）</a></p>

<script>
    {
        'use strict';

        // エンターキーでイベント発火
        document.getElementById('k').onkeydown = function() {
            if (event.key === 'Enter') set();
        };
        document.getElementById('v').onkeydown = function() {
            if (event.key === 'Enter') set();
        };

        //変数storageにlocalStorageを格納
        var storage = localStorage;

        show_result();

        // データを保存する
        function set() {
            var k = document.getElementById("k").value;
            var v = document.getElementById("v").value;
            storage.setItem(k, v);
            show_result();
        }

        // データを全てクリアする
        function cle() {
            storage.clear();
            show_result();
        }

        // 対象キーのデータをクリアする
        function keyCle(k) {
            storage.removeItem(k);
            show_result();
        }

        // キー情報を取得
        function keyCopy(k) {
            document.getElementById("k").value = k;
        }

        function show_result() {
            // 子要素を全て削除
            var textbox_element = document.getElementById('textbox');
            while (textbox_element.firstChild) {
                textbox_element.removeChild(textbox_element.firstChild);
            }
            // 保存されているデータの数だけループ
            for (var i=0; i<storage.length; i++) {
                // i番目のキーを取得
                var k = storage.key(i);
                // ボックスdiv作成
                var box_element = document.createElement('div');
                box_element.style = "display: flex; justify-content: space-between; width: 500px; border-bottom: solid 1px #333;";
                // box_element.style.backgroundColor = "#ff838b";
                box_element.style.paddingTop = "10px";
                // テキストdiv作成
                var text_element = document.createElement('div');
                text_element.textContent = k + "：" + storage.getItem(k);
                text_element.setAttribute('onclick', `keyCopy(${k})`);
                box_element.appendChild(text_element);
                // 削除div作成
                var delete_element = document.createElement('div');
                delete_element.textContent = '×';
                const message = 'テキスト(id:' + k + ')を削除してよいですか？';
                delete_element.setAttribute('onclick', `if (confirm('${message}')) keyCle(${k}); return false;`);
                box_element.appendChild(delete_element);
                // 指定した要素の中の末尾に挿入
                textbox_element.appendChild(box_element);
            }
        }
        
    };
</script>
</div>