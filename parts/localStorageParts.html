<div id="localStorage">
    <h1>WebStorage</h1>
    <p id="lastModified"></p>

    <h2>localStorage(ver0.01)</h2>
    <div id="textbox"></div>
    <div style="padding-top: 5px; display: flex;">
        <p>キー：<input id="k" type="text" onfocus="this.select();"></p>
        <p>値：<input id="v" type="text" onfocus="this.select();"></p>
    </div>
    <div style="padding-top: 5px;">
        <input type="button" value="新規・更新" onClick="set()">
        <input type="button" value="全クリア" onClick="if (confirm('テキストを全て削除してよいですか？')) cle(); return false;">
    </div>
    <p><a href="http://www.htmq.com/webstorage/">Web Storage－HTML5のAPI - HTMLクイックリファレンス（参考）</a></p>

</div>
<script src="../js/util.js"></script>
<script src="../js/common.js"></script>
<script>
    {
        'use strict';

        // 変数storageにlocalStorageを格納
        var storage = localStorage;

        // エンターキーでイベント発火
        document.getElementById('k').onkeydown = function () {
            if (event.key === 'Enter') set();
        };
        document.getElementById('v').onkeydown = function () {
            if (event.key === 'Enter') set();
        };

        show_result();

        // データを保存する
        function set() {
            var k = document.getElementById("k").value;
            if (k === '') return;
            var v = document.getElementById("v").value;
            storage.setItem(k, v);
            show_result();
        }

        // データを全てクリアする
        function cle() {
            storage.clear();
            show_result();
        }

        // 対象キーのデータをクリアする
        function keyCle(k) {
            storage.removeItem(k);
            show_result();
        }

        // キー情報を取得
        function keyCopy(k, v) {
            document.getElementById("k").value = k;
            document.getElementById("v").value = v;
        }

        // キー情報を取得
        function show_result() {
            // 子要素を全て削除
            var textbox_element = document.getElementById('textbox');
            while (textbox_element.firstChild) {
                textbox_element.removeChild(textbox_element.firstChild);
            }
            // 保存されているデータの数だけループ
            for (var i = 0; i < storage.length; i++) {
                // i番目のキーを取得
                const k = storage.key(i);
                // ボックスdiv作成
                const box_element = document.createElement('div');
                box_element.style = "display: flex; justify-content: space-between; width: 500px; border-bottom: solid 1px #333;";
                box_element.style.paddingTop = "10px";
                // テキストdiv作成
                const text_element = document.createElement('div');
                text_element.textContent = k + "：" + storage.getItem(k);
                text_element.setAttribute('onclick', `keyCopy('${k}', '${storage.getItem(k)}')`);
                box_element.appendChild(text_element);
                // 削除div作成
                const delete_element = document.createElement('div');
                delete_element.textContent = '×';
                const message = 'テキスト(id:' + k + ')を削除してよいですか？';
                delete_element.setAttribute('onclick', `if (confirm('${message}')) keyCle('${k}'); return false;`);
                box_element.appendChild(delete_element);
                // 指定した要素の中の末尾に挿入
                textbox_element.appendChild(box_element);
            }
        }
    };
</script>