<main>
    <h1>Docker</h1>
    <p id="lastModified"></p>

    <h2>Dockerとは</h2>
    <p>Dockerは、OSレベルの仮想化を用いて、コンテナと呼ばれるパッケージでソフトウェアを提供するPaaS製品群である。</p>
    <p>手元のPCとサーバー側のDockerのコンテナを展開できる。環境の差異を気にすることなく開発することが出来る。</p>
    <h3>XAMPPとの違い</h3>
    <p>『XAMPP』で複数プロジェクトを作ろうとした時、『XAMPP』も複数インストールする必要があるので手間がかかります。</p>
    <p>しかし『Docker』なら簡単に複製できるので便利です。ただし『Docker』を扱う知識が必要、って感じ。</p>
    <p>『XAMPP』と『Docker』どちらも有効なものなので、初心者は状況に合わせてどちらも学んでゆくのが良いです。</p>
    <h4>XAMPP</h4>
    <p>PHPのローカル開発環境を作るために必要なものがそろったセット</p>
    <p>『XAMPP』を使えば簡単にローカル開発環境を作れるのがメリット。</p>
<pre>
X…クロスプラットフォーム(Win、Macの両方対応してること)
A…Apache(Webサーバー)
M…MariaDBもしくはMySQL(データベースサーバー)
P…PHP
P…Perl(プログラミング言語)
</pre>
    <h4>『Docker』は仮想環境を作るためのソフト</h4>
    <p>Docker社が提供する仮想環境を作ったり配布・実行するためのプラットフォームです。「コンテナ」と呼ばれる技術を使って仮想環境を作ります。</p>
    <p>Dockerのメリットは簡単に開発環境を作れるうえ「環境を複製や削除しやすいこと」です。チームで開発する時に、環境を全く同じにできます。</p>
<pre>
Dockerエンジン　パソコンのOS上で用意されたコンテナが動かせるようになる
Dockerイメージ　コンテナの実行に必要なファイルがまとめられています
コンテナ　Dockerイメージによって作られます(ビルドする)
</pre>
    <p><a href="https://yadokariming.site/php-local-dev/">【参考】初心者でもわかるPHPの【ローカル開発環境】とは？《XAMPP/MAMP・Dockerの違い》</a></p>

    <h2>Docker環境構築(20230212時点)</h2>
    <p><a href="https://dotinstall.com/lessons/basic_dockerdesktop_win/">【引用】Dockerを導入しよう [Windows 10版]</a></p>
    <h3>Docker Desktopをインストール</h3>
    <p>以下より「Docker Desktop Installer.exe」をダウンロードしてクリック</p>
    <p><a href="https://www.docker.com/products/docker-desktop/">docker-desktopダウンロード</a></p>
    <p>Windows上でLinuxを動かすことが出来る機能である「WSL2」のインストールが促されるらしいが。私の環境では促されなかった。インストールが必要らしい。既に入っているのかな。以下のurlからダウンロードするらしい。(x64 マシン用 WSL2 Linux カーネル更新プログラム パッケージ)</p>
    <p>インストールが終わったらリスタートを押してdockerを再起動するらしい。</p>
    <h3>DockerDesktopを起動</h3>
    <p>DockerDesktopを起動すると以下のような文言が出てきた。個人は無料とのこと。同意をクリック</p>
    <figure>
        <img class="beside" src="../img/Docker/Docker環境構築(20230212時点)/DockerDesktopを起動.PNG" alt="DockerDesktopを起動.PNG">
        <figcaption>DockerDesktopを起動.PNG</figcaption>
    </figure>
<pre>
    Docker サブスクリプション サービス契約
    [同意する] を選択すると、サブスクリプション サービス契約、Docker データ処理契約、およびデータ プライバシー ポリシーに同意したことになります。    
    注: Docker Desktop は、中小企業 (従業員 250 人未満かつ年間売上高 1,000 万ドル未満)、個人使用、教育、および非営利のオープン ソース プロジェクトには無料です。 それ以外の場合は、プロ向けの有料サブスクリプションが必要です。 政府機関にも有料サブスクリプションが必要です。 詳細については、FAQ をお読みください。
</pre>
    <p>起動すると今週のtipsが表示されるが閉じておく</p>
    <figure>
        <img class="beside" src="../img/Docker/Docker環境構築(20230212時点)/今週のtips.PNG" alt="今週のtips.PNG">
        <figcaption>今週のtips.PNG</figcaption>
    </figure>
    <p>今後はコマンドラインから操作するのでDockerDesktopを閉じておく</p>
    <p>Dockerが起動しているかどうかは、タスクバーのクジラのアイコンで確認できる。「Docker Desktop is running」と出ていれば起動している。</p>
    <figure>
        <img class="beside" src="../img/Docker/Docker環境構築(20230212時点)/Dockerが起動しているか.PNG" alt="Dockerが起動しているか.PNG">
        <figcaption>Dockerが起動しているか.PNG</figcaption>
    </figure>
    <h3>Ubuntuの導入</h3>
    <p>「Windows PowerShell」を起動</p>
    <p>「wsl --set-default-version 2」を実行</p>
    <p>これをしておけば、WSL2対応のLinuxを導入できるようになるらしい。</p>
    <p>WSL2とは。WSLとは、Windows上でLinuxを動作させるための実行環境です。新しいバージョンである「WSL2」ではWindows上で「完全なLinux」が動かせるようになり、できることが大幅に増えました。</p>
    <p><a href="https://www.kagoya.jp/howto/it-glossary/develop/wsl2_linux/">WindowsでWSL2を使って「完全なLinux」環境を作ろう！</a>
<pre>
<code>
PS C:\Users\*****> wsl --set-default-version 2
WSL 2 との主な違いについては、https://aka.ms/wsl2 を参照してください
この操作を正しく終了しました。
</code>
</pre>
    <p>以下のリンクからubuntuをインストール</p>
    <p><a href="https://aka.ms/wslstore">Microsoft Store</a>
    <p>「ubuntu」で検索して色々種類があるが、何も書かれていない「ubuntu」を入手</p>
<figure>
    <img class="beside" src="../img/Docker/Docker環境構築(20230212時点)/Ubuntuで検索.PNG" alt="Ubuntuで検索.PNG">
    <figcaption>Ubuntuで検索.PNG</figcaption>
</figure>
    <h3>Ubuntuを起動</h3>
    <p>起動するとユーザー名とパスワードを入力が促されるらしい(Ubuntu用のアカウントの作成)</p>
    <p>Windowsのアカウントとは別なので適当なユーザーとパスワードを入力する。</p>
    <p>以下私の環境では何故か促されなかった？？？設定が終わると入力待ちになる。Ubuntuを閉じておく。</p>
    <p>私の環境はルートユーザーのようなので、別でユーザーを作成する必要があるのかも知れないがとりあえず作成せずこのまま進める</p>
    <figure>
        <img class="beside" src="../img/Docker/Docker環境構築(20230212時点)/Ubuntuを起動.PNG" alt="Ubuntuを起動.PNG">
        <figcaption>Ubuntuを起動.PNG</figcaption>
    </figure>
    <h3>UbuntuからDockerを使えるようにする</h3>
    <p>Dockerのアイコンを右クリック。Settingsをクリック。</p>
    <figure>
        <img class="beside" src="../img/Docker/Docker環境構築(20230212時点)/DockerSettings.PNG" alt="DockerSettings.PNG">
        <figcaption>DockerSettings.PNG</figcaption>
    </figure>
    <p>Resourcesタブ - WSL Integrationタブ 「Ubuntu」にチェックを入れて「Apply」をクリック。右上の×ボタンでDocker Desktopを閉じる。</p>
    <figure>
        <img class="beside" src="../img/Docker/Docker環境構築(20230212時点)/UbuntuからDockerを使えるようにする.PNG" alt="UbuntuからDockerを使えるようにする.PNG">
        <figcaption>UbuntuからDockerを使えるようにする.PNG</figcaption>
    </figure>
    <h3>VS codeでの使い方</h3>
    <p>VS Codeを起動</p>
    <p>ターミナルを開く</p>
    <p>試しにターミナルが右上の設定が「powershell」の状態でLinuxコマンドであるgrepを使用してみる。そのようなコマンドは無いとエラーになってしまう。</p>
    <figure>
        <img class="beside" src="../img/Docker/Docker環境構築(20230212時点)/powershellではgrepが使えない.PNG" alt="powershellではgrepが使えない.PNG">
        <figcaption>powershellではgrepが使えない.PNG</figcaption>
    </figure>
    <p>Ubuntu(WSL)を選択する</p>
    <figure>
        <img class="beside" src="../img/Docker/Docker環境構築(20230212時点)/Ubuntu(WSL)を選択.PNG" alt="Ubuntu(WSL)を選択.PNG">
        <figcaption>Ubuntu(WSL)を選択.PNG</figcaption>
    </figure>
    <p>grepが使える状態であることを確認</p>
    <figure>
        <img class="beside" src="../img/Docker/Docker環境構築(20230212時点)/grepが使える状態である.PNG" alt="grepが使える状態である.PNG">
        <figcaption>grepが使える状態である.PNG</figcaption>
    </figure>
    <p>Dockerを使って開発する時はLinuxのコマンドを使えたほうがいいらしい。</p>

    <h2>Docker上で動く仮想マシンの名前をコンテナと呼ぶ</h2>

    <h2>PHPのコンテナについて</h2>
<pre>
work/
  ├ app/
  ├ public/
public・・・ブラウザからアクセスできるファイル
app・・・ブラウザからアクセスして欲しくないファイル
localhostの8562番を使用する。
</pre>

<h2>Mysqlのコンテナ</h2>
<pre>
Host:db
Database:myapp
User:myappuser
Password:myapppass
</pre>

<h2>Docker + PHP 開発環境構築</h2>
<h3>フォルダ構成等について</h3>
<pre>
=====フォルダ構成=====
root/
    ├ mysql/
    │       ├ Dockerfile
    │       └ my.cnf
    ├ php/
    │       ├ Dockerfile
    │       └ php.ini-development
    ├ work/
    │       ├ app/
    │       │   └ .gitkeep
    │       └ public/
    │           └ index.php
    └ docker-compose.yml

=====docker-compose.yml=====
---

version: '3.8'
services:
  db:
    build: ./mysql
    environment:
      TZ: "Asia/Tokyo"
      MYSQL_ROOT_PASSWORD: rootpass
      MYSQL_DATABASE: myapp
      MYSQL_USER: myappuser
      MYSQL_PASSWORD: myapppass
    volumes:
    - db-data:/var/lib/mysql
  php:
    build: ./php
    depends_on:
    - db
    ports:
    - 8562:8000
    volumes:
    - ./work:/work

volumes:
  db-data:
==========
DBとPHPというコンテナが設定が書かれている。
MySQLの設定情報が書かれている。
ブラウザからアクセスする際の8562番ポートを使う。
workディレクトリが同期されるよという設定が書かれている。
=====index.php=====
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;ja&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;utf-8&quot;&gt;
  &lt;title&gt;My Todos&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;h1&gt;Todos&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
    <h2>Docker起動。環境にアクセス</h2>
    <p>vs codeのターミナルにて「docker-compose up -d」で起動。(初回起動は10分ほどかかるらしい)</p>
    <p>「ctl + l」でターミナルをクリア</p>
    <p>「http://localhost:8562/」で環境にアクセス</p>
    <figure>
        <img class="beside" src="../img/Docker/Docker環境構築(20230212時点)/環境にアクセス.PNG" alt="環境にアクセス.PNG">
        <figcaption>環境にアクセス.PNG</figcaption>
    </figure>

    <h2>MySQLにログイン</h2>
    <p>「docker-compose exec db bash」でdbコンテナにログイン</p>
    <p>「mysql -u」</p>

</main>
<div id="log"></div>
<script src="../js/util.js"></script>
<script src="../js/config.js"></script>
<script src="../js/common.js"></script>
 
